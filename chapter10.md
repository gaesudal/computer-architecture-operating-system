# CHAPTER 10 : 프로세스와 스레드

## 10.1 프로세스 개요

- 포그라운드 프로세스 : 사용자가 보는 앞에서 실행
- 백그라운드 프로세스 : 사용자가 보지 못하는 뒤에서 실행
- 데몬 : 유닉스 체계의 운영체제에서의 백그라운드 프로세스
- 서비스 : 윈도우 운영체제에서의 백그라운드 프로세스

### 프로세스 제어 블록

운영체제는 바르게 번갈아 수행되는 프로세스의 실행 순서를 관리하고, 프로세스에 CPU를 비롯한 자원을 배분, 이를 위해 운영체제는 **프로세스 제어 블록(PCB)**를 이용

PCB는 커널 영역에 생성, 특정 프로세스를 식별하고 해당 프로세스를 처리 ⇒ 프로세스 생성 시에 만들어지고 실행이 끝나면 폐기

- 프로세스 ID : 특정 프로세스를 식별하기 위해 부여하는 고유한 번호
- 레지스터 값 : 프로세스는 자신의 실행 차례가 돌아오면 이전까지 사용했던 레지스터의 중간값들을 모두 복원 → 이전까지 진행했던 작업들을 이어서 실행할 수 있어야 하기 때문에 ⇒ PCB 안에는 해당 프로세스가 실행하며 사용했던 프로그램 카운터를 비롯한 레지스터 값들이 담김
- 프로세스 상태  : 프로세스가 어떤 상태인지 기록
- CPU 스케줄링 정보 : 프로세스가 언제, 어떤 순서로 CPU를 할당받을지에 대한 정보 PCB에 기록
- 메모리 관리 정보 : 프로세스마다 메모리에 저장된 위치가 다르기 때문에 PCB에는 프로세스가 어느 주소에 저장되어 있는지에 대한 정보가 있어야함. PCB에는 베이스 레지스터, 한계 레지스터 값과 같은 정보들이 담깁니다.
- 사용한 파일과 입출력장치 목록 : 어떤 입출력장치가 이 프로세스에 할당되었는지, 어떤 파일들을 열었는지에 대한 정보들이 PCB에 기록

### 문맥 교환

프로세스가 CPU사용을 양보할 때 바로 직전가지 실행되던 프로세스의 프로그램 카운터, 레지스터 값, 메모리 정보, 실행을 위해 열었단 파일이나 사용한 입출력장치 등 중간 정보를 백업해야 함.

이러한 프로세스 수행을 재개하기 위해 기억해야 할 정보를 **문맥**이라고 함

하나의 프로세스 문맥은 해당 프로세스의 PCB에 표현, 기존 프로세스의 문맥을 PCB에 백업하고, 새로운 프로세스를 실행하기 위해 문맥을 PCB로부터 복구하여 새로운 프로세스를 실행하는 것을 **문맥 교환**이라 함

### 프로세스의 메모리 영역

- 코드 영역 : 텍스트 영역이라고도 부르며, 실행할 수 있는 코드, 즉 기계어로 이루어진 명령어가 저장
- 데이터 영역 : 잠깐 썼다가 없앨 데이터가 아닌 프로그램이 실행되는 동안 유지할 데이터가 저장되는 공간, 전역변수가 대표적

코드 영역과 데이터 영역은 그 크기가 변하지 않아 **정적 할당 영역**이라고도 부름. 반면 힙 영역과 스택 영역은 프로세스 실행 과정에서 크기가 변할 수 있는 영역이기 때문에 **동적 할당 영역**이라고도 부름

- 힙 영역 : 프로그램을 만드는 사용자, 즉 프로그래머가 직접 할당할 수 있는 저장공간
프로그래밍 과정에서 힙 영역에 메모리 공간을 할당했다면 해당 공간을 반환해야함.
반환하지 않는다면 **메모리 누수** 발생
- 스택 영역 : 데이터를 일시적으로 저장하는 공간. 데이터 영역에 담기는 값과 달리 잠깐 쓰다가 말 값들이 저장 0> 함수의 실행이 끝나면 사라지는 매개변수, 지역변수가 대표적

## 10.2 프로세스 상태와 계층 구조

### 프로세스 상태

- 생성 상태 : 프로세스를 생성 중인 상태. 이제 막 메모리에 적재되어 PCB를 할당받은 상태
- 준비 상태 : 당장이라도 CPU를 할당받아 실행할 수 있지만, 아직 자신의 차례가 아니기에 기다리고 있는 상태
- 실행 상태 : CPU를 할당받아 실행 중인 상태. 프로세스가 할당된 시간을 모두 사용한다면 다시 준비 상태가 되고, 실행 도중 입출력장치를 사용하여 입출력 장치의 작업이 끝날 때까지 기다려야 한다면 대기 상태
- 대기 상태 : 입출력장치의 작업을 기다리는 상태
- 종료 상태 : 프로세스가 종료된 상태. PCB와 프로세스가 사용한 메모리를 정리

### 프로세스 계층 구조

프로세스는 실행 도중 시스템 호출을 통해 다른 프로세스를 생성할 수 있음.

- 부모 프로세스 : 새 프로세스를 생성한 프로세스
- 자식 프로세스 : 부모 프로세스에 의해 생성된 프로세스, (PCB에 부모의 PID인 PPID가 기록되기도함)

### 프로세스 생성 기법

부모 프로세스는 **fork**를 통해 자신의 복사본을 자식 프로세스로 생성해내고, 만들어진복사본은 **exec**를 통해 자신의 메모리 공간을 다른 프로그램으로 교체

## 10.3 스레드

프로세스를 구성하는 실행의 흐름 단위

### 프로세스와 스레드

- 단일 스레드 프로세스 : 실행의 흐름 단위가 하나
- 멀티스레드 : 여러 스레드로 프로세스를 동시에 실행 ⇒ 여러 프로세스를 동시에 실행하는 것을 **멀티프로세스**

프로세스 끼리는 기본적으로 자원을 공유하지 않지만, 스레드끼리는 같은 프로세스 내의 자원을 공유

⇒ 코드 영역, 데이터 영역, 힙, 파일을 스레드가 공유함